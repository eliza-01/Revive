# Flows в Revive

## 1. Что такое Flow
Flow — это список шагов, описывающих последовательность действий для конкретной задачи (например, баф через Dashboard).  
Файл `flows/<feature>.py` содержит **чистую декларацию шагов** без кода логики, что позволяет менять сценарий без переписывания рабочих классов (`Worker`).

---

## 2. Структура шага
Каждый шаг — это `dict` с ключами:

| Ключ           | Описание |
|----------------|----------|
| `op`           | Операция (тип шага, см. ниже) |
| `zone`         | Одна зона для поиска (если операция работает в одной зоне) |
| `zones`        | Список зон (если поиск в нескольких) |
| `tpl`          | Имя шаблона, который ищем |
| `timeout_ms`   | Время ожидания совпадения шаблона в миллисекундах |
| `thr`          | Порог совпадения (0.0–1.0) |
| `ms`           | Для `sleep` — пауза в миллисекундах |
| `cmd`          | Для `send_arduino` — команда для Arduino |
| `delay_ms`     | Для `send_arduino` — задержка после отправки |

---

## 3. Операции (`op`)

### `click_any`
Ищет шаблон (`tpl`) в **любой зоне** из списка `zones`.  
Как только нашёл — кликает и переходит к следующему шагу.  
Полезно, когда элемент может находиться в разных частях UI.

```python
{"op": "click_any", "zones": ["dashboard_tab", "dashboard_body"], "tpl": "buffer_button", "timeout_ms": 2000, "thr": 0.87}
```

### `click_in`
Ищет шаблон (tpl) в одной конкретной зоне (zone).
Если не найден в течение timeout_ms — ошибка.

```python
{"op": "click_in", "zone": "dashboard_body", "tpl": "buffer_restore_hp", "timeout_ms": 1000, "thr": 0.87}
```

### `optional_click`
То же, что click_in, но если элемент не найден — шаг считается успешным и сценарий продолжается.
Используется для элементов, которые могут отсутствовать (например, кнопка восстановления HP).


```python
{"op": "optional_click", "zone": "dashboard_body", "tpl": "buffer_restore_hp", "timeout_ms": 1000, "thr": 0.87}
```

### wait
**Ждёт появления шаблона (tpl) в зоне без клика.
Если не найден в течение timeout_ms — ошибка.**

```python
{"op": "wait", "zone": "dashboard_body", "tpl": "buffer_init", "timeout_ms": 2000, "thr": 0.87}
```

### sleep
Пауза в миллисекундах.

```python
{"op": "sleep", "ms": 500}
```

### send_arduino
Отправка команды на Arduino через ReviveController.

```python
{"op": "send_arduino", "cmd": "b", "delay_ms": 100}
```

### cmd — строка-команда для прошивки Arduino.
delay_ms — опциональная задержка после отправки.

### 5. Вызов Flow
   В BuffAfterRespawnWorker есть цикл по FLOW, где в зависимости от op вызываются соответствующие обработчики (click_in, click_any, wait, sleep, send_arduino).

